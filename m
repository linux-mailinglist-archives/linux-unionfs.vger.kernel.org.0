Return-Path: <linux-unionfs-owner@vger.kernel.org>
X-Original-To: lists+linux-unionfs@lfdr.de
Delivered-To: lists+linux-unionfs@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 9ABBB416E35
	for <lists+linux-unionfs@lfdr.de>; Fri, 24 Sep 2021 10:50:06 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S244456AbhIXIvi (ORCPT <rfc822;lists+linux-unionfs@lfdr.de>);
        Fri, 24 Sep 2021 04:51:38 -0400
Received: from szxga03-in.huawei.com ([45.249.212.189]:16292 "EHLO
        szxga03-in.huawei.com" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
        with ESMTP id S244334AbhIXIvi (ORCPT
        <rfc822;linux-unionfs@vger.kernel.org>);
        Fri, 24 Sep 2021 04:51:38 -0400
Received: from dggeme752-chm.china.huawei.com (unknown [172.30.72.57])
        by szxga03-in.huawei.com (SkyGuard) with ESMTP id 4HG5LP13BHz8tKZ;
        Fri, 24 Sep 2021 16:49:17 +0800 (CST)
Received: from dggeme756-chm.china.huawei.com (10.3.19.102) by
 dggeme752-chm.china.huawei.com (10.3.19.98) with Microsoft SMTP Server
 (version=TLS1_2, cipher=TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256) id
 15.1.2308.8; Fri, 24 Sep 2021 16:50:03 +0800
Received: from dggeme756-chm.china.huawei.com ([10.6.80.68]) by
 dggeme756-chm.china.huawei.com ([10.6.80.68]) with mapi id 15.01.2308.008;
 Fri, 24 Sep 2021 16:50:03 +0800
From:   "zhengliang (A)" <zhengliang6@huawei.com>
To:     139 <cgxu519@139.com>
CC:     "miklos@szeredi.hu" <miklos@szeredi.hu>,
        "linux-unionfs@vger.kernel.org" <linux-unionfs@vger.kernel.org>,
        "zhangyi (F)" <yi.zhang@huawei.com>
Subject: [PATCH] ovl: fix oops in ovl_rename
Thread-Topic: [PATCH] ovl: fix oops in ovl_rename
Thread-Index: AQHXsODKn1Cd/ru1PU6Kgobs5MUua6uyPxSAgACc/VA=
Date:   Fri, 24 Sep 2021 08:50:03 +0000
Message-ID: <233d2f5ffba043bdb8976256bec3bc27@huawei.com>
References: <20210924011628.2069334-1-zhengliang6@huawei.com>
 <E376E38A-ABB0-4E20-B7C8-980F8CFC2047@139.com>
In-Reply-To: <E376E38A-ABB0-4E20-B7C8-980F8CFC2047@139.com>
Accept-Language: zh-CN, en-US
Content-Language: zh-CN
X-MS-Has-Attach: 
X-MS-TNEF-Correlator: 
x-originating-ip: [10.174.176.200]
Content-Type: text/plain; charset="utf-8"
Content-Transfer-Encoding: base64
MIME-Version: 1.0
X-CFilter-Loop: Reflected
Precedence: bulk
List-ID: <linux-unionfs.vger.kernel.org>
X-Mailing-List: linux-unionfs@vger.kernel.org

DQoNCj4g77u/V2UgZmluZCBhIGtlcm5lbCBOVUxMIHBvaW50ZXIgZGVyZWZlcmVuY2UgcHJvYmxl
bSBpbiBvdmVybGF5ZnMuDQo+IFRoZSBwcm9ibGVtIGNhbiBhcHBlYXIgaW4gdGhlIGZvbGxvd2lu
ZyBzY2VuZToNCj4gDQo+IG1rZGlyIGxvd2VyIHVwcGVyIHdvcmsgbWVyZ2UNCj4gdG91Y2ggbG93
ZXIvb2xkDQo+IHRvdWNoIGxvd2VyL25ldw0KPiBtb3VudCAtdCBvdmVybGF5IG92ZXJsYXkgLW9s
b3dlcmRpcj1sb3dlcix1cHBlcmRpcj11cHBlcix3b3JrZGlyPXdvcmsgDQo+IG1lcmdlIHJtIG1l
cmdlL25ldw0KPiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCj4gcHJvY2VzcyBB
KHJlbmFtZSBmaWxlIGluIG1lcmdlKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJv
Y2VzcyBCKGRlbGV0ZSBmaWxlIGluIHVwcGVyKQ0KPiByZW5hbWVhdDIoQVRfRkRDV0QsICJvbGQi
LCBBVF9GRENXRCwgIm5ldyIsIDApIChuZXcgaXMgd2hpdGVvdXQgZmlsZSANCj4gaW4gdXBwZXIp
DQo+ICBkb19yZW5hbWVhdDINCj4gICAgdmZzX3JlbmFtZQ0KPiAgICAgIG92bF9yZW5hbWUNCj4g
ICAgICAob3ZlcndyaXRlPXRydWUsb3ZsX2xvd2VyX3Bvc2l0aXZlKG9sZCk9dHJ1ZSwNCj4gICAg
ICBvdmxfZGVudHJ5X2lzX3doaXRlb3V0KG5ldyk9dHJ1ZSkNCj4gICAgICAod2UgY2FuIGFkZCBz
b21lIGRlbGF5IGFmdGVyICJmbGFnc3w9UkVOQU1FX0VYQ0hBTkdFIiwNCj4gICAgICBpdCBjYW4g
bWFrZSB0aGUgcHJvYmxlbSBhcHBlYXIgbW9yZSBlYXN5KQ0KPiAgICAgIOKApuKApiAgICAgICAg
ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1bmxpbmsobmV3
KQ0KPiAgICAgIOKApuKApiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg
ICAgICAgICAgICAgICAoZGVsZXRlIHdoaXRlb3V0IGluIHVwcGVyKQ0KPiAgICAgIChuZXdkZW50
cnkgaXMgbmVnYXRpdmUpDQo+ICAgICAgICBvdmxfZG9fcmVuYW1lDQoNCklzIGl0IGEgcmVhbCB1
c2UgY2FzZT8gSSBiZWxpZXZlIHRoZXJlIHdpbGwgYmUgbWFueSB1bmV4cGVjdGVkIGJlaGF2aW9y
cyBpZiB5b3UgZGVsZXRlIHRoZSBmaWxlcyBpbiB1cHBlciBsYXllciBkZWxpYmVyYXRlbHkuDQoN
ClRoYW5rcywNCkNoZW5nZ3VhbmcNCg0KDQpBcyBkZXNjcmliZWQgaW4gdGhlIGRvY3VtZW50YXRp
b24gKERvY3VtZW50YXRpb24vZmlsZXN5c3RlbXMvb3ZlcmxheWZzLnJzdCkNCiAgICAgICBDaGFu
Z2VzIHRvIHVuZGVybHlpbmcgZmlsZXN5c3RlbXMNCiAgICAgICAtLS0tLS0tLS0tLS0tLS0tLS0t
LS0tLS0tLS0tLS0tLS0NCiAgICAgIENoYW5nZXMgdG8gdGhlIHVuZGVybHlpbmcgZmlsZXN5c3Rl
bXMgd2hpbGUgcGFydCBvZiBhIG1vdW50ZWQgb3ZlcmxheQ0KICAgICAgZmlsZXN5c3RlbSBhcmUg
bm90IGFsbG93ZWQuICBJZiB0aGUgdW5kZXJseWluZyBmaWxlc3lzdGVtIGlzIGNoYW5nZWQsDQog
ICAgICB0aGUgYmVoYXZpb3Igb2YgdGhlIG92ZXJsYXkgaXMgdW5kZWZpbmVkLCB0aG91Z2ggaXQg
d2lsbCBub3QgcmVzdWx0IGluDQogICAgICBhIGNyYXNoIG9yIGRlYWRsb2NrLg0KU28sIFdlIHNo
b3VsZCBwcm9iYWJseSBmaXggdGhpcyBjcmFzaCBwcm9ibGVtLg0KDQo+IA0KPiBTbyxiZWZvcmUg
Y29tbWVuY2luZyB3aXRoIG92bF9kb19yZW5hbWUgdGhhdCB0aGUgZmxhZ3MgbWF5YmUgYXR0YWNo
IA0KPiBSRU5BTUVfRVhDSEFOR0UgYW5kIHRoZSBuZXdkZW50cnkgaXMgbmVnYXRpdmUgaW4gb3Zs
X3JlbmFtZS5JZiB3ZSANCj4gZW5hYmxlZCBzZWxpbnV4LGl0IHdpbGwgbGVhZCB0byBrZXJuZWwg
cGFuaWMuc3VjaCBhcyB0aGUgZm9sbG93aW5nIGxvZzoNCj4gUElEOiAyNTUyMDQ1ICBUQVNLOiBm
ZmZmODg4MDMwMmZhZjAwICBDUFU6IDIgICBDT01NQU5EOiAiZnNzdHJlc3MiDQo+ICMwIFtmZmZm
ODg4MDgwZTc3MmEwXSBtYWNoaW5lX2tleGVjIGF0IGZmZmZmZmZmODU2YWRlZGMNCj4gIzEgW2Zm
ZmY4ODgwODBlNzczYThdIF9fY3Jhc2hfa2V4ZWMgYXQgZmZmZmZmZmY4NTg1Y2QyMA0KPiAjMiBb
ZmZmZjg4ODA4MGU3NzRjMF0gcGFuaWMgYXQgZmZmZmZmZmY4NTcyYjI4OA0KPiAjMyBbZmZmZjg4
ODA4MGU3NzU5MF0gb29wc19lbmQgYXQgZmZmZmZmZmY4NTY0MWY2ZQ0KPiAjNCBbZmZmZjg4ODA4
MGU3NzVmMF0gX19kb19wYWdlX2ZhdWx0IGF0IGZmZmZmZmZmODU2Y2Q1NWINCj4gIzUgW2ZmZmY4
ODgwODBlNzc2NjhdIGRvX3BhZ2VfZmF1bHQgYXQgZmZmZmZmZmY4NTZjZDgzNA0KPiAjNiBbZmZm
Zjg4ODA4MGU3NzZhMF0gYXN5bmNfcGFnZV9mYXVsdCBhdCBmZmZmZmZmZjg2NjAxMjVlDQo+ICAg
IFtleGNlcHRpb24gUklQOiBfX2lub2RlX3NlY3VyaXR5X3JldmFsaWRhdGUrMzRdDQo+ICAgIFJJ
UDogZmZmZmZmZmY4NWM0MzQ1MiAgUlNQOiBmZmZmODg4MDgwZTc3NzU4ICBSRkxBR1M6IDAwMDEw
MjAyDQo+ICAgIFJBWDogMDAwMDAwMDAwMDAwMDAwMCAgUkJYOiAwMDAwMDAwMDAwMDAwMDAwICBS
Q1g6IGZmZmZmZmZmODU5M2FlN2UNCj4gICAgUkRYOiAwMDAwMDAwMDAwMDAwMDAwICBSU0k6IDAw
MDAwMDAwMDAwMDAyOTcgIFJESTogMDAwMDAwMDAwMDAwMDI5Nw0KPiAgICBSQlA6IGZmZmY4ODgx
OTg0ZTY2MjggICBSODogZmZmZmVkMTAxMTVlM2YzOSAgIFI5OiBmZmZmZWQxMDExNWUzZjM5DQo+
ICAgIFIxMDogMDAwMDAwMDAwMDAwMDAwMSAgUjExOiBmZmZmZWQxMDExNWUzZjM4ICBSMTI6IDAw
MDAwMDAwMDAwMDAwMDENCj4gICAgUjEzOiAwMDAwMDAwMDAwMDAwMDAwICBSMTQ6IGZmZmY4ODgw
ODM1MGEwMDAgIFIxNTogMWZmZmYxMTAxMDFjZWVmNQ0KPiAgICBPUklHX1JBWDogZmZmZmZmZmZm
ZmZmZmZmZiAgQ1M6IDAwMTAgIFNTOiAwMDE4DQo+ICM3IFtmZmZmODg4MDgwZTc3NzgwXSBzZWxp
bnV4X2lub2RlX3JlbmFtZSBhdCBmZmZmZmZmZjg1YzQ0MThkDQo+ICM4IFtmZmZmODg4MDgwZTc3
ODU4XSBzZWN1cml0eV9pbm9kZV9yZW5hbWUgYXQgZmZmZmZmZmY4NWMzNWYyNA0KPiAjOSBbZmZm
Zjg4ODA4MGU3Nzg5MF0gdmZzX3JlbmFtZSBhdCBmZmZmZmZmZjg1YjAxMjA5DQo+ICMxMCBbZmZm
Zjg4ODA4MGU3NzlhOF0gb3ZsX2RvX3JlbmFtZSBhdCBmZmZmZmZmZmMwYTQ0YzIyIFtvdmVybGF5
XQ0KPiAjMTEgW2ZmZmY4ODgwODBlNzc5ZDhdIG92bF9yZW5hbWUgYXQgZmZmZmZmZmZjMGE0NjU3
NSBbb3ZlcmxheV0NCj4gIzEyIFtmZmZmODg4MDgwZTc3YjQ4XSB2ZnNfcmVuYW1lIGF0IGZmZmZm
ZmZmODViMDE1NWENCj4gIzEzIFtmZmZmODg4MDgwZTc3YzYwXSBkb19yZW5hbWVhdDIgYXQgZmZm
ZmZmZmY4NWIwNmU2NQ0KPiAjMTQgW2ZmZmY4ODgwODBlNzdmMDBdIF9feDY0X3N5c19yZW5hbWVh
dDIgYXQgZmZmZmZmZmY4NWIwNmZiMg0KPiAjMTUgW2ZmZmY4ODgwODBlNzdmMzBdIGRvX3N5c2Nh
bGxfNjQgYXQgZmZmZmZmZmY4NTYwNjI0Mw0KPiAjMTYgW2ZmZmY4ODgwODBlNzdmNTBdIGVudHJ5
X1NZU0NBTExfNjRfYWZ0ZXJfaHdmcmFtZSBhdCANCj4gZmZmZmZmZmY4NjYwMDBhZA0KPiANCj4g
V2UgY2FuIGFkZCBzb21lIGNoZWNrIGluIG92bF9yZW5hbWUgZm9yIHRoaXMgc2NlbmUgYW5kIHJl
dHVybiBlcnJvciB0byBhdm9pZCBrZXJuZWwgcGFuaWMuDQo+IA0KPiBTaWduZWQtb2ZmLWJ5OiBa
aGVuZyBMaWFuZyA8emhlbmdsaWFuZzZAaHVhd2VpLmNvbT4NCj4gLS0tDQo+IGZzL292ZXJsYXlm
cy9kaXIuYyB8IDEwICsrKysrKystLS0NCj4gMSBmaWxlIGNoYW5nZWQsIDcgaW5zZXJ0aW9ucygr
KSwgMyBkZWxldGlvbnMoLSkNCj4gDQo+IGRpZmYgLS1naXQgYS9mcy9vdmVybGF5ZnMvZGlyLmMg
Yi9mcy9vdmVybGF5ZnMvZGlyLmMgaW5kZXggDQo+IDFmZWZiMmI4OTYwZS4uOTNjN2MyNjdkZTkz
IDEwMDY0NA0KPiAtLS0gYS9mcy9vdmVybGF5ZnMvZGlyLmMNCj4gKysrIGIvZnMvb3ZlcmxheWZz
L2Rpci5jDQo+IEBAIC0xMjE5LDkgKzEyMTksMTMgQEAgc3RhdGljIGludCBvdmxfcmVuYW1lKHN0
cnVjdCB1c2VyX25hbWVzcGFjZSAqbW50X3VzZXJucywgc3RydWN0IGlub2RlICpvbGRkaXIsDQo+
ICAgICAgICAgICAgICAgIGdvdG8gb3V0X2RwdXQ7DQo+ICAgICAgICB9DQo+ICAgIH0gZWxzZSB7
DQo+IC0gICAgICAgIGlmICghZF9pc19uZWdhdGl2ZShuZXdkZW50cnkpICYmDQo+IC0gICAgICAg
ICAgICAoIW5ld19vcGFxdWUgfHwgIW92bF9pc193aGl0ZW91dChuZXdkZW50cnkpKSkNCj4gLSAg
ICAgICAgICAgIGdvdG8gb3V0X2RwdXQ7DQo+ICsgICAgICAgIGlmICghZF9pc19uZWdhdGl2ZShu
ZXdkZW50cnkpKSB7DQo+ICsgICAgICAgICAgICBpZiAoIW5ld19vcGFxdWUgfHwgIW92bF9pc193
aGl0ZW91dChuZXdkZW50cnkpKQ0KPiArICAgICAgICAgICAgICAgIGdvdG8gb3V0X2RwdXQ7DQo+
ICsgICAgICAgIH0gZWxzZSB7DQo+ICsgICAgICAgICAgICBpZiAoZmxhZ3MgJiBSRU5BTUVfRVhD
SEFOR0UpDQo+ICsgICAgICAgICAgICAgICAgZ290byBvdXRfZHB1dDsNCj4gKyAgICAgICAgfQ0K
PiAgICB9DQo+IA0KPiAgICBpZiAob2xkZGVudHJ5ID09IHRyYXApDQo+IC0tDQo+IDIuMjUuNA0K
PiANCg0KDQo=
